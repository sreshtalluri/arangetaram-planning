---
phase: 01-foundation-authentication
plan: 05
type: execute
wave: 4
depends_on: ["01-04"]
files_modified:
  - frontend/src/pages/SignupPage.tsx
  - frontend/src/pages/VendorSignupPage.tsx
  - frontend/src/pages/LoginPage.jsx
  - frontend/src/pages/PasswordResetPage.tsx
  - frontend/src/pages/AuthCallbackPage.tsx
  - frontend/src/App.js
autonomous: true

must_haves:
  truths:
    - "User can create account at /signup with role=user"
    - "Vendor can create account at /vendor/signup with role=vendor"
    - "User can log in at /login"
    - "User can request password reset via email"
    - "Email verification callback is handled"
    - "Specific error messages shown for auth failures"
  artifacts:
    - path: "frontend/src/pages/SignupPage.tsx"
      provides: "User signup form with email/password/name"
      min_lines: 80
    - path: "frontend/src/pages/VendorSignupPage.tsx"
      provides: "Vendor signup form"
      min_lines: 80
    - path: "frontend/src/pages/LoginPage.jsx"
      provides: "Updated login using Supabase auth"
      contains: "signIn"
    - path: "frontend/src/pages/PasswordResetPage.tsx"
      provides: "Password reset request and update forms"
      min_lines: 60
    - path: "frontend/src/pages/AuthCallbackPage.tsx"
      provides: "Email verification callback handler"
      min_lines: 30
  key_links:
    - from: "frontend/src/pages/SignupPage.tsx"
      to: "frontend/src/hooks/useAuth.ts"
      via: "signUp function call"
      pattern: "signUp.*user"
    - from: "frontend/src/pages/LoginPage.jsx"
      to: "frontend/src/hooks/useAuth.ts"
      via: "signIn function call"
      pattern: "signIn"
    - from: "frontend/src/App.js"
      to: "frontend/src/pages/AuthCallbackPage.tsx"
      via: "route definition"
      pattern: "/auth/callback"
---

<objective>
Create auth UI pages for user signup, vendor signup, login, password reset, and email verification callback.

Purpose: Provide the user-facing interfaces for authentication flows. Separate signup pages for users and vendors ensure clear role assignment from the start per CONTEXT.md decisions.

Output: Complete auth UI pages integrated with Supabase auth, routing configured in App.js.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation-authentication/01-CONTEXT.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@frontend/src/pages/RegisterPage.jsx
@frontend/src/pages/LoginPage.jsx
@frontend/src/hooks/useAuth.ts
@frontend/src/App.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create user and vendor signup pages</name>
  <files>
    - frontend/src/pages/SignupPage.tsx
    - frontend/src/pages/VendorSignupPage.tsx
  </files>
  <action>
1. Create `frontend/src/pages/SignupPage.tsx` for regular users:

```typescript
import { useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { Button } from '../components/ui/button'
import { Input } from '../components/ui/input'
import { Label } from '../components/ui/label'
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '../components/ui/card'
import { useToast } from '../hooks/use-toast'

export default function SignupPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [fullName, setFullName] = useState('')
  const [loading, setLoading] = useState(false)
  const { signUp } = useAuth()
  const navigate = useNavigate()
  const { toast } = useToast()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    try {
      await signUp(email, password, 'user', fullName)
      toast({
        title: 'Check your email',
        description: 'We sent you a verification link. Please check your inbox.',
      })
      navigate('/login')
    } catch (error) {
      toast({
        title: 'Signup failed',
        description: error instanceof Error ? error.message : 'An error occurred',
        variant: 'destructive',
      })
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-background p-4">
      <Card className="w-full max-w-md">
        <CardHeader>
          <CardTitle>Create an Account</CardTitle>
          <CardDescription>
            Sign up to start planning your Arangetram
          </CardDescription>
        </CardHeader>
        <form onSubmit={handleSubmit}>
          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="fullName">Full Name</Label>
              <Input
                id="fullName"
                value={fullName}
                onChange={(e) => setFullName(e.target.value)}
                placeholder="Your name"
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="you@example.com"
                required
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="password">Password</Label>
              <Input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="Create a password"
                required
                minLength={6}
              />
            </div>
          </CardContent>
          <CardFooter className="flex flex-col space-y-4">
            <Button type="submit" className="w-full" disabled={loading}>
              {loading ? 'Creating account...' : 'Sign Up'}
            </Button>
            <p className="text-sm text-muted-foreground">
              Already have an account?{' '}
              <Link to="/login" className="text-primary hover:underline">
                Log in
              </Link>
            </p>
            <p className="text-sm text-muted-foreground">
              Are you a vendor?{' '}
              <Link to="/vendor/signup" className="text-primary hover:underline">
                Sign up as a vendor
              </Link>
            </p>
          </CardFooter>
        </form>
      </Card>
    </div>
  )
}
```

2. Create `frontend/src/pages/VendorSignupPage.tsx` with role='vendor':

Similar structure but:
- Title: "Register as a Vendor"
- Description: "Create your vendor profile to reach families planning Arangetrams"
- Call signUp with 'vendor' role
- Link to regular signup instead of vendor signup
  </action>
  <verify>
- `cat frontend/src/pages/SignupPage.tsx | grep "signUp.*user"` finds role assignment
- `cat frontend/src/pages/VendorSignupPage.tsx | grep "signUp.*vendor"` finds role assignment
- Both files import from useAuth hook
  </verify>
  <done>User and vendor signup pages created with appropriate role assignment</done>
</task>

<task type="auto">
  <name>Task 2: Update login page and create password reset</name>
  <files>
    - frontend/src/pages/LoginPage.jsx
    - frontend/src/pages/PasswordResetPage.tsx
  </files>
  <action>
1. Update `frontend/src/pages/LoginPage.jsx` to use new auth:

Replace the existing auth import and logic:
```jsx
// Remove: import { useAuth } from '../lib/auth'
import { useAuth } from '../hooks/useAuth'
```

Update the login handler to use signIn:
```jsx
const { signIn, loading } = useAuth()

const handleSubmit = async (e) => {
  e.preventDefault()
  setIsLoading(true)

  try {
    await signIn(email, password)
    // Redirect handled by auth state change
    const from = location.state?.from?.pathname || '/'
    navigate(from, { replace: true })
  } catch (error) {
    toast({
      title: 'Login failed',
      description: error.message, // Specific error from auth-supabase.ts
      variant: 'destructive',
    })
  } finally {
    setIsLoading(false)
  }
}
```

Add link to password reset:
```jsx
<Link to="/forgot-password" className="text-sm text-primary hover:underline">
  Forgot password?
</Link>
```

2. Create `frontend/src/pages/PasswordResetPage.tsx`:

Two forms in one page:
- Request form (email input) - shown at /forgot-password
- Update form (new password) - shown at /auth/reset-password (after clicking email link)

Use URL to detect which form to show:
```typescript
import { useState, useEffect } from 'react'
import { useNavigate, useSearchParams, useLocation } from 'react-router-dom'
import { resetPassword, updatePassword } from '../lib/auth-supabase'
// ... UI components

export default function PasswordResetPage() {
  const location = useLocation()
  const isUpdateMode = location.pathname === '/auth/reset-password'

  // Show email form or new password form based on route
  if (isUpdateMode) {
    return <UpdatePasswordForm />
  }
  return <RequestResetForm />
}
```
  </action>
  <verify>
- `grep "useAuth.*hooks" frontend/src/pages/LoginPage.jsx` finds new import
- `grep "signIn" frontend/src/pages/LoginPage.jsx` finds new auth call
- `cat frontend/src/pages/PasswordResetPage.tsx` shows both request and update forms
  </verify>
  <done>Login page uses new auth, password reset flow complete with email request and update forms</done>
</task>

<task type="auto">
  <name>Task 3: Create auth callback page and update routes</name>
  <files>
    - frontend/src/pages/AuthCallbackPage.tsx
    - frontend/src/App.js
  </files>
  <action>
1. Create `frontend/src/pages/AuthCallbackPage.tsx`:

This handles the redirect from email verification and password reset:
```typescript
import { useEffect, useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { supabase } from '../lib/supabase'

export default function AuthCallbackPage() {
  const navigate = useNavigate()
  const [message, setMessage] = useState('Verifying...')

  useEffect(() => {
    // Supabase handles the token exchange from URL hash
    // We just need to wait for session and redirect
    const handleCallback = async () => {
      const { data: { session }, error } = await supabase.auth.getSession()

      if (error) {
        setMessage('Verification failed. Please try again.')
        setTimeout(() => navigate('/login'), 3000)
        return
      }

      if (session) {
        setMessage('Email verified! Redirecting...')
        // Redirect based on role
        const role = session.user.user_metadata?.role
        const destination = role === 'vendor' ? '/vendor/dashboard' : '/dashboard'
        setTimeout(() => navigate(destination), 1500)
      } else {
        setMessage('Please log in to continue.')
        setTimeout(() => navigate('/login'), 2000)
      }
    }

    handleCallback()
  }, [navigate])

  return (
    <div className="min-h-screen flex items-center justify-center bg-background">
      <div className="text-center">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
        <p className="text-muted-foreground">{message}</p>
      </div>
    </div>
  )
}
```

2. Update `frontend/src/App.js` routes:

Add new routes:
```jsx
import SignupPage from './pages/SignupPage'
import VendorSignupPage from './pages/VendorSignupPage'
import PasswordResetPage from './pages/PasswordResetPage'
import AuthCallbackPage from './pages/AuthCallbackPage'

// In Routes:
<Route path="/signup" element={<SignupPage />} />
<Route path="/vendor/signup" element={<VendorSignupPage />} />
<Route path="/forgot-password" element={<PasswordResetPage />} />
<Route path="/auth/reset-password" element={<PasswordResetPage />} />
<Route path="/auth/callback" element={<AuthCallbackPage />} />
```

Keep existing /register route pointing to RegisterPage.jsx for now (gradual migration).
Update navigation links in Navbar.jsx to point to /signup instead of /register.
  </action>
  <verify>
- `cat frontend/src/pages/AuthCallbackPage.tsx` shows email verification handling
- `grep "/signup\|/vendor/signup\|/auth/callback" frontend/src/App.js` finds new routes
- `grep "SignupPage\|VendorSignupPage" frontend/src/App.js` finds imports
  </verify>
  <done>Auth callback handles email verification, all auth routes configured in App.js</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Navigate to /signup - shows user signup form
2. Navigate to /vendor/signup - shows vendor signup form
3. Navigate to /login - shows login form with forgot password link
4. Navigate to /forgot-password - shows email input for password reset
5. Email verification redirects to /auth/callback and then to appropriate dashboard
</verification>

<success_criteria>
- User signup at /signup sets role='user' in user_metadata
- Vendor signup at /vendor/signup sets role='vendor' in user_metadata
- Login shows specific error messages ("Email or password is incorrect", "Please verify your email")
- Password reset flow sends email and allows password update
- Email verification callback redirects appropriately based on role
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-05-SUMMARY.md`
</output>
