---
phase: 05-inquiry-connection
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - frontend/src/components/inquiry/SendInquiryDialog.jsx
  - frontend/src/pages/VendorDetailPage.jsx
autonomous: true

must_haves:
  truths:
    - "User can send inquiry from vendor detail page"
    - "Inquiry form shows event selector if user has multiple events"
    - "Event details preview is shown before sending"
    - "Optional message field available"
    - "Success/error feedback via toast"
    - "User without events sees prompt to create event first"
  artifacts:
    - path: "frontend/src/components/inquiry/SendInquiryDialog.jsx"
      provides: "Modal for sending inquiries"
      min_lines: 80
    - path: "frontend/src/pages/VendorDetailPage.jsx"
      provides: "Updated with real inquiry integration"
      contains: "SendInquiryDialog"
  key_links:
    - from: "SendInquiryDialog.jsx"
      to: "useInquiries.ts"
      via: "useSendInquiry hook"
      pattern: "useSendInquiry"
    - from: "VendorDetailPage.jsx"
      to: "SendInquiryDialog.jsx"
      via: "import and render"
---

<objective>
Implement Send Inquiry dialog and integrate with VendorDetailPage.

Purpose: Enable users to send inquiries to vendors with event context
Output: Working inquiry submission from vendor detail page
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-inquiry-connection/05-CONTEXT.md
@.planning/phases/05-inquiry-connection/05-RESEARCH.md

Files to reference:
@frontend/src/pages/VendorDetailPage.jsx
@frontend/src/hooks/useEvents.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SendInquiryDialog component</name>
  <files>frontend/src/components/inquiry/SendInquiryDialog.jsx</files>
  <action>
Create inquiry dialog following existing Dialog patterns in VendorDetailPage.

Props:
- vendorId: string
- vendorName: string
- userId: string
- open: boolean
- onOpenChange: (open: boolean) => void

Features:
1. Fetch user's events with useEvents(userId)
2. If multiple events: show Select dropdown to choose which event
3. If single event: auto-select and show event details
4. If no events: show amber message "Please create an event first to send an inquiry"
5. Show event details preview (date, location, guests, budget)
6. Optional message Textarea
7. Submit button disabled when no events or sending
8. Loading state with Loader2 spinner
9. Handle 23505 duplicate error with "You have already sent an inquiry for this event"
10. Success toast: "Inquiry sent successfully!"

Use existing UI components:
- Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter
- Button, Textarea, Select, SelectContent, SelectItem, SelectTrigger, SelectValue
- toast from sonner
- Loader2 from lucide-react
- format, parseISO from date-fns

Structure:
```jsx
export function SendInquiryDialog({ vendorId, vendorName, userId, open, onOpenChange }) {
  const { data: events = [], isLoading: eventsLoading } = useEvents(userId)
  const sendInquiry = useSendInquiry()
  const [selectedEventId, setSelectedEventId] = useState('')
  const [message, setMessage] = useState('')

  // Auto-select if single event
  useEffect(() => {
    if (events.length === 1) setSelectedEventId(events[0].id)
  }, [events])

  const selectedEvent = events.find(e => e.id === selectedEventId)

  const handleSubmit = async () => {
    try {
      await sendInquiry.mutateAsync({
        userId,
        vendorId,
        eventId: selectedEventId,
        message: message || undefined,
      })
      toast.success('Inquiry sent successfully!')
      onOpenChange(false)
      setMessage('')
    } catch (error) {
      toast.error(error.message || 'Failed to send inquiry')
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      ...
    </Dialog>
  )
}
```
  </action>
  <verify>
Check: Component renders without errors
Check: Event selector appears when multiple events
Check: Single event auto-selects with preview
Check: No events shows warning message
  </verify>
  <done>
SendInquiryDialog component exists with event selection, preview, message field, and proper error handling
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate SendInquiryDialog in VendorDetailPage</name>
  <files>frontend/src/pages/VendorDetailPage.jsx</files>
  <action>
Replace demo booking dialog with real SendInquiryDialog.

Changes:
1. Import SendInquiryDialog from '../components/inquiry/SendInquiryDialog'
2. Import useSendInquiry if needed for any additional logic
3. Replace the existing bookingOpen Dialog with SendInquiryDialog

Update handleBookClick:
```jsx
const handleBookClick = async () => {
  if (!isAuthenticated) {
    toast.info("Please sign in to send an inquiry")
    navigate("/login")
  } else {
    setBookingOpen(true)
  }
}
```

Replace the Dialog JSX (lines ~288-324) with:
```jsx
<SendInquiryDialog
  vendorId={id}
  vendorName={vendor.business_name}
  userId={user?.id}
  open={bookingOpen}
  onOpenChange={setBookingOpen}
/>
```

Remove the old handleBookingRequest function and message state since they're now handled by SendInquiryDialog.
  </action>
  <verify>
Check: VendorDetailPage loads without errors
Check: "Send Inquiry" button opens dialog
Check: Dialog shows user's events
Check: Successful inquiry shows toast and closes dialog
  </verify>
  <done>
VendorDetailPage uses SendInquiryDialog for real inquiry submission instead of demo mode
  </done>
</task>

</tasks>

<verification>
- [ ] SendInquiryDialog component exists at components/inquiry/SendInquiryDialog.jsx
- [ ] Component handles multiple events, single event, and no events cases
- [ ] VendorDetailPage imports and uses SendInquiryDialog
- [ ] Inquiry submission works end-to-end
- [ ] Toast notifications show on success/error
</verification>

<success_criteria>
Users can send inquiries to vendors from vendor detail page. Event context is automatically included.
</success_criteria>

<output>
After completion, create `.planning/phases/05-inquiry-connection/05-03-SUMMARY.md`
</output>
