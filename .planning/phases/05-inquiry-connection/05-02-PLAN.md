---
phase: 05-inquiry-connection
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/hooks/useInquiries.ts
autonomous: true

must_haves:
  truths:
    - "User can fetch their sent inquiries with vendor/event details"
    - "Vendor can fetch their received inquiries with user/event details"
    - "User can send inquiry to vendor"
    - "Vendor can respond to inquiry (accept/decline)"
    - "Unread count is available for badge display"
  artifacts:
    - path: "frontend/src/hooks/useInquiries.ts"
      provides: "All inquiry CRUD operations"
      exports: ["useUserInquiries", "useVendorInquiries", "useSendInquiry", "useRespondToInquiry", "useUnreadCount", "useMarkInquiryRead"]
  key_links:
    - from: "useInquiries.ts"
      to: "supabase"
      via: "supabase.from('inquiries')"
      pattern: "from\\('inquiries'"
---

<objective>
Create React Query hooks for all inquiry operations.

Purpose: Provide data layer for inquiry system UI
Output: useInquiries.ts with all CRUD hooks following existing patterns
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-inquiry-connection/05-CONTEXT.md
@.planning/phases/05-inquiry-connection/05-RESEARCH.md

Existing hook patterns to follow:
@frontend/src/hooks/useEvents.ts
@frontend/src/hooks/useSavedVendors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useInquiries hook with all CRUD operations</name>
  <files>frontend/src/hooks/useInquiries.ts</files>
  <action>
Create comprehensive inquiry hooks following useEvents/useSavedVendors patterns.

Types (at top of file):
```typescript
export interface Inquiry {
  id: string
  user_id: string
  vendor_id: string
  event_id: string
  message: string | null
  status: 'pending' | 'accepted' | 'declined'
  response_message: string | null
  responded_at: string | null
  user_read_at: string | null
  vendor_read_at: string | null
  created_at: string
  updated_at: string
}

export interface InquiryWithDetails extends Inquiry {
  event: {
    id: string
    event_name: string
    event_date: string
    location: string | null
    guest_count: number | null
    budget: number | null
  }
  vendor_profile: {
    id: string
    business_name: string
    category: string
    profile_photo_url: string | null
    contact_email: string | null
    contact_phone: string | null
  }
  user_profile: {
    id: string
    full_name: string | null
    email: string
  }
}
```

Hooks to implement:

1. useUserInquiries(userId: string | undefined)
   - queryKey: ['inquiries', 'user', userId]
   - Select with joins: event:events(...), vendor_profile:vendor_profiles(...)
   - Order by created_at DESC
   - staleTime: 30 * 1000

2. useVendorInquiries(vendorId: string | undefined)
   - queryKey: ['inquiries', 'vendor', vendorId]
   - Select with joins: event:events(...), user_profile:profiles(id, full_name, email)
   - Order by created_at DESC
   - staleTime: 30 * 1000

3. useSendInquiry()
   - Insert with user_id, vendor_id, event_id, message
   - Handle 23505 error (duplicate) with friendly message
   - Invalidate ['inquiries', 'user', userId] on success

4. useRespondToInquiry()
   - Update status, response_message, responded_at
   - Invalidate both user and vendor inquiry queries

5. useMarkInquiryRead(role: 'user' | 'vendor')
   - Update user_read_at or vendor_read_at
   - Invalidate unread-count query

6. useUnreadCount(userId: string | undefined, role: 'user' | 'vendor')
   - For vendor: count where vendor_read_at IS NULL
   - For user: count where status != 'pending' AND user_read_at IS NULL
   - staleTime: 10 * 1000, refetchInterval: 30 * 1000

7. useInquiryStats(vendorId: string | undefined)
   - Return { total, pending, accepted, declined }
   - staleTime: 30 * 1000

Use 'as any' pattern for .from() calls like existing hooks since table not in generated types.
  </action>
  <verify>
Run: `cd frontend && npm run type-check` or `tsc --noEmit`
Check: All hooks export correctly
Check: Query keys follow existing patterns
  </verify>
  <done>
useInquiries.ts exports all 7 hooks with proper React Query patterns, error handling, and cache invalidation
  </done>
</task>

</tasks>

<verification>
- [ ] useInquiries.ts exists with all required hooks
- [ ] Hooks follow existing useEvents/useSavedVendors patterns
- [ ] Proper error handling for duplicate inquiries
- [ ] Cache invalidation on mutations
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
All inquiry data operations available via hooks. Ready for UI integration.
</success_criteria>

<output>
After completion, create `.planning/phases/05-inquiry-connection/05-02-SUMMARY.md`
</output>
