---
phase: 02-vendor-supply-platform
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/vendor-categories.ts
  - frontend/src/lib/metro-areas.ts
  - frontend/src/hooks/useVendorProfile.ts
  - frontend/src/hooks/usePortfolio.ts
  - frontend/src/hooks/useAvailability.ts
autonomous: true

must_haves:
  truths:
    - "All 11 vendor categories are defined with cultural context"
    - "Metro area list covers major US cities with South Asian communities"
    - "useVendorProfile hook provides CRUD operations"
    - "usePortfolio hook manages image list and ordering"
    - "useAvailability hook manages blocked dates"
  artifacts:
    - path: "frontend/src/lib/vendor-categories.ts"
      provides: "Category definitions with icons and descriptions"
      exports: ["VENDOR_CATEGORIES", "VendorCategory"]
    - path: "frontend/src/lib/metro-areas.ts"
      provides: "Service area options for vendors"
      exports: ["METRO_AREAS"]
    - path: "frontend/src/hooks/useVendorProfile.ts"
      provides: "Vendor profile React Query hooks"
      exports: ["useVendorProfile", "useCreateVendorProfile", "useUpdateVendorProfile"]
    - path: "frontend/src/hooks/usePortfolio.ts"
      provides: "Portfolio image management hooks"
      exports: ["usePortfolio", "useAddPortfolioImage", "useDeletePortfolioImage", "useReorderPortfolio"]
    - path: "frontend/src/hooks/useAvailability.ts"
      provides: "Availability calendar hooks"
      exports: ["useAvailability", "useBlockDates", "useUnblockDate"]
  key_links:
    - from: "frontend/src/hooks/useVendorProfile.ts"
      to: "vendor_profiles table"
      via: "supabase.from('vendor_profiles')"
      pattern: "from\\('vendor_profiles'\\)"
---

<objective>
Create category definitions, metro area list, and React Query hooks for vendor profile, portfolio, and availability management.

Purpose: Provides reusable data access layer and constants that all vendor components will use.
Output: Category/metro constants and 3 custom hooks ready for consumption.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-vendor-supply-platform/02-RESEARCH.md

@frontend/src/lib/supabase.ts
@frontend/src/hooks/useProfile.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create category and metro area constants</name>
  <files>frontend/src/lib/vendor-categories.ts, frontend/src/lib/metro-areas.ts</files>
  <action>
Create **vendor-categories.ts** with all 11 Arangetram vendor categories:

```typescript
export const VENDOR_CATEGORIES = [
  {
    value: 'venue',
    label: 'Venue',
    description: 'Temples, cultural centers, banquet halls for the ceremony',
    icon: 'Building2',
  },
  {
    value: 'catering',
    label: 'Catering',
    description: 'South Indian cuisine and traditional feast preparation',
    icon: 'UtensilsCrossed',
  },
  {
    value: 'photography',
    label: 'Photography',
    description: 'Professional photography for the dance debut',
    icon: 'Camera',
  },
  {
    value: 'videography',
    label: 'Videography',
    description: 'Video recording and highlights of the performance',
    icon: 'Video',
  },
  {
    value: 'stage_decoration',
    label: 'Stage Decoration',
    description: 'Traditional stage setup with flowers and drapery',
    icon: 'Palette',
  },
  {
    value: 'musicians',
    label: 'Musicians',
    description: 'Carnatic music accompaniment for the performance',
    icon: 'Music',
  },
  {
    value: 'nattuvanar',
    label: 'Nattuvanar',
    description: 'Dance conductor providing rhythmic recitation',
    icon: 'Mic2',
  },
  {
    value: 'makeup_artist',
    label: 'Makeup Artist',
    description: 'Traditional Bharatanatyam makeup and styling',
    icon: 'Sparkles',
  },
  {
    value: 'invitations',
    label: 'Invitations & Printing',
    description: 'Traditional invitation cards and event programs',
    icon: 'Mail',
  },
  {
    value: 'costumes',
    label: 'Costumes & Jewelry',
    description: 'Bharatanatyam costumes and temple jewelry rental',
    icon: 'Crown',
  },
  {
    value: 'return_gifts',
    label: 'Return Gifts',
    description: 'Traditional return gifts for guests',
    icon: 'Gift',
  },
] as const

export type VendorCategory = typeof VENDOR_CATEGORIES[number]['value']

export function getCategoryByValue(value: string) {
  return VENDOR_CATEGORIES.find(cat => cat.value === value)
}
```

Create **metro-areas.ts** with major US metros with South Asian communities:

```typescript
export const METRO_AREAS = [
  // California
  { value: 'sf-bay-area', label: 'San Francisco Bay Area', state: 'CA' },
  { value: 'los-angeles', label: 'Los Angeles', state: 'CA' },
  { value: 'san-diego', label: 'San Diego', state: 'CA' },
  // Texas
  { value: 'houston', label: 'Houston', state: 'TX' },
  { value: 'dallas-ft-worth', label: 'Dallas-Fort Worth', state: 'TX' },
  { value: 'austin', label: 'Austin', state: 'TX' },
  // East Coast
  { value: 'nyc-metro', label: 'New York City Metro', state: 'NY/NJ' },
  { value: 'boston', label: 'Boston', state: 'MA' },
  { value: 'washington-dc', label: 'Washington D.C. Metro', state: 'DC/VA/MD' },
  { value: 'philadelphia', label: 'Philadelphia', state: 'PA' },
  // Midwest
  { value: 'chicago', label: 'Chicago', state: 'IL' },
  { value: 'detroit', label: 'Detroit', state: 'MI' },
  { value: 'minneapolis', label: 'Minneapolis', state: 'MN' },
  // Southeast
  { value: 'atlanta', label: 'Atlanta', state: 'GA' },
  { value: 'charlotte', label: 'Charlotte', state: 'NC' },
  { value: 'raleigh', label: 'Raleigh-Durham', state: 'NC' },
  { value: 'tampa', label: 'Tampa Bay', state: 'FL' },
  // Pacific Northwest
  { value: 'seattle', label: 'Seattle', state: 'WA' },
  { value: 'portland', label: 'Portland', state: 'OR' },
  // Other
  { value: 'phoenix', label: 'Phoenix', state: 'AZ' },
  { value: 'denver', label: 'Denver', state: 'CO' },
] as const

export type MetroArea = typeof METRO_AREAS[number]['value']
```
  </action>
  <verify>
- Files exist with correct exports
- VENDOR_CATEGORIES has exactly 11 entries
- VendorCategory type is exported
- METRO_AREAS covers Bay Area, LA, Houston, Dallas, NYC, Chicago, Atlanta, Seattle
  </verify>
  <done>
Category definitions with cultural context and metro area list ready for use in profile wizard.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create vendor data hooks</name>
  <files>frontend/src/hooks/useVendorProfile.ts, frontend/src/hooks/usePortfolio.ts, frontend/src/hooks/useAvailability.ts</files>
  <action>
Create **useVendorProfile.ts** following useProfile.ts pattern:

```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { supabase } from '../lib/supabase'
import type { Database } from '../lib/database.types'

type VendorProfile = Database['public']['Tables']['vendor_profiles']['Row']
type VendorProfileInsert = Database['public']['Tables']['vendor_profiles']['Insert']
type VendorProfileUpdate = Database['public']['Tables']['vendor_profiles']['Update']

export function useVendorProfile(vendorId: string | undefined) {
  return useQuery({
    queryKey: ['vendor-profile', vendorId],
    queryFn: async (): Promise<VendorProfile | null> => {
      if (!vendorId) return null
      const { data, error } = await supabase
        .from('vendor_profiles')
        .select('*')
        .eq('id', vendorId)
        .single()
      if (error && error.code !== 'PGRST116') throw error
      return data
    },
    enabled: !!vendorId,
    staleTime: 60 * 1000,
  })
}

export function useCreateVendorProfile() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async (profile: VendorProfileInsert) => {
      const { data, error } = await supabase
        .from('vendor_profiles')
        .insert(profile)
        .select()
        .single()
      if (error) throw error
      return data
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['vendor-profile', data.id] })
    },
  })
}

export function useUpdateVendorProfile() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async ({ id, ...updates }: VendorProfileUpdate & { id: string }) => {
      const { data, error } = await supabase
        .from('vendor_profiles')
        .update({ ...updates, updated_at: new Date().toISOString() })
        .eq('id', id)
        .select()
        .single()
      if (error) throw error
      return data
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['vendor-profile', data.id] })
    },
  })
}

export type { VendorProfile, VendorProfileInsert, VendorProfileUpdate }
```

Create **usePortfolio.ts**:

```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { supabase } from '../lib/supabase'
import type { Database } from '../lib/database.types'

type PortfolioImage = Database['public']['Tables']['portfolio_images']['Row']

export function usePortfolio(vendorId: string | undefined) {
  return useQuery({
    queryKey: ['portfolio', vendorId],
    queryFn: async (): Promise<PortfolioImage[]> => {
      if (!vendorId) return []
      const { data, error } = await supabase
        .from('portfolio_images')
        .select('*')
        .eq('vendor_id', vendorId)
        .order('order_index', { ascending: true })
      if (error) throw error
      return data || []
    },
    enabled: !!vendorId,
    staleTime: 60 * 1000,
  })
}

export function useAddPortfolioImage() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async (image: { vendor_id: string; storage_path: string; caption?: string; order_index: number }) => {
      const { data, error } = await supabase
        .from('portfolio_images')
        .insert(image)
        .select()
        .single()
      if (error) throw error
      return data
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['portfolio', data.vendor_id] })
    },
  })
}

export function useDeletePortfolioImage() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async ({ id, vendorId }: { id: string; vendorId: string }) => {
      const { error } = await supabase
        .from('portfolio_images')
        .delete()
        .eq('id', id)
      if (error) throw error
      return { id, vendorId }
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['portfolio', data.vendorId] })
    },
  })
}

export function useReorderPortfolio() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async ({ vendorId, images }: { vendorId: string; images: { id: string; order_index: number }[] }) => {
      // Update all order indices in a transaction
      const updates = images.map(img =>
        supabase.from('portfolio_images').update({ order_index: img.order_index }).eq('id', img.id)
      )
      await Promise.all(updates)
      return { vendorId }
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['portfolio', data.vendorId] })
    },
  })
}

export type { PortfolioImage }
```

Create **useAvailability.ts**:

```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { supabase } from '../lib/supabase'
import type { Database } from '../lib/database.types'
import { format, parseISO } from 'date-fns'

type VendorAvailability = Database['public']['Tables']['vendor_availability']['Row']

export function useAvailability(vendorId: string | undefined) {
  return useQuery({
    queryKey: ['availability', vendorId],
    queryFn: async (): Promise<VendorAvailability[]> => {
      if (!vendorId) return []
      const { data, error } = await supabase
        .from('vendor_availability')
        .select('*')
        .eq('vendor_id', vendorId)
        .order('blocked_date', { ascending: true })
      if (error) throw error
      return data || []
    },
    enabled: !!vendorId,
    staleTime: 60 * 1000,
  })
}

export function useBlockDates() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async ({ vendorId, dates, note }: { vendorId: string; dates: Date[]; note?: string }) => {
      const records = dates.map(date => ({
        vendor_id: vendorId,
        blocked_date: format(date, 'yyyy-MM-dd'),
        note,
      }))
      // Use upsert to handle duplicates gracefully
      const { error } = await supabase
        .from('vendor_availability')
        .upsert(records, { onConflict: 'vendor_id,blocked_date' })
      if (error) throw error
      return { vendorId }
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['availability', data.vendorId] })
    },
  })
}

export function useUnblockDate() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async ({ vendorId, date }: { vendorId: string; date: Date }) => {
      const { error } = await supabase
        .from('vendor_availability')
        .delete()
        .eq('vendor_id', vendorId)
        .eq('blocked_date', format(date, 'yyyy-MM-dd'))
      if (error) throw error
      return { vendorId }
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['availability', data.vendorId] })
    },
  })
}

// Helper to convert availability records to Date objects for calendar
export function useBlockedDates(vendorId: string | undefined) {
  const { data: availability, ...rest } = useAvailability(vendorId)
  const blockedDates = availability?.map(a => parseISO(a.blocked_date)) || []
  return { blockedDates, availability, ...rest }
}

export type { VendorAvailability }
```
  </action>
  <verify>
- All three hook files exist with correct exports
- useVendorProfile handles PGRST116 error code
- usePortfolio orders by order_index ascending
- useAvailability uses format(date, 'yyyy-MM-dd') for DATE storage
- Hooks use queryClient.invalidateQueries pattern from useProfile.ts
  </verify>
  <done>
Three React Query hooks ready: useVendorProfile (CRUD), usePortfolio (images with ordering), useAvailability (blocked dates).
  </done>
</task>

</tasks>

<verification>
1. VENDOR_CATEGORIES.length === 11
2. METRO_AREAS includes Bay Area, Houston, NYC, Chicago, Atlanta
3. useVendorProfile imports supabase and uses 'vendor_profiles' table
4. usePortfolio orders results by order_index
5. useAvailability formats dates as 'yyyy-MM-dd' strings
</verification>

<success_criteria>
- All 11 categories defined with value, label, description, icon
- Metro areas cover major South Asian community hubs
- Hooks follow existing useProfile.ts patterns (staleTime, PGRST116 handling)
- Types exported for consumer components
</success_criteria>

<output>
After completion, create `.planning/phases/02-vendor-supply-platform/02-02-SUMMARY.md`
</output>
