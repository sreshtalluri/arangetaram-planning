---
phase: 02-vendor-supply-platform
plan: 04
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - frontend/src/components/vendor/ProfileWizard/index.tsx
  - frontend/src/components/vendor/ProfileWizard/StepProgress.tsx
  - frontend/src/components/vendor/ProfileWizard/StepBasics.tsx
  - frontend/src/components/vendor/ProfileWizard/StepCategory.tsx
  - frontend/src/components/vendor/ProfileWizard/StepServices.tsx
  - frontend/src/pages/vendor/ProfileWizardPage.tsx
  - frontend/src/App.js
autonomous: true

must_haves:
  truths:
    - "Vendor can complete 4-step profile wizard"
    - "Progress auto-saves to localStorage on change"
    - "Vendor can resume wizard after refresh"
    - "Profile saves to database on completion"
    - "Wizard shows progress indicator"
  artifacts:
    - path: "frontend/src/components/vendor/ProfileWizard/index.tsx"
      provides: "Multi-step wizard container"
      min_lines: 80
    - path: "frontend/src/pages/vendor/ProfileWizardPage.tsx"
      provides: "Wizard page with auth check"
      min_lines: 20
  key_links:
    - from: "ProfileWizard/index.tsx"
      to: "useCreateVendorProfile"
      via: "mutation on form submit"
      pattern: "useCreateVendorProfile"
    - from: "StepCategory.tsx"
      to: "VENDOR_CATEGORIES"
      via: "import for category selection"
      pattern: "from.*vendor-categories"
---

<objective>
Create multi-step profile wizard with auto-save, covering basics (name, description), category selection, and services (areas, pricing). Portfolio step will be added separately.

Purpose: Provides the primary vendor onboarding flow with a guided wizard experience that saves progress automatically.
Output: 4-step wizard (Basics, Category, Services, Review) with localStorage persistence and database save.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-vendor-supply-platform/02-CONTEXT.md
@.planning/phases/02-vendor-supply-platform/02-RESEARCH.md

@frontend/src/hooks/useVendorProfile.ts
@frontend/src/lib/vendor-categories.ts
@frontend/src/lib/metro-areas.ts
@frontend/src/App.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create wizard components</name>
  <files>
    frontend/src/components/vendor/ProfileWizard/index.tsx,
    frontend/src/components/vendor/ProfileWizard/StepProgress.tsx,
    frontend/src/components/vendor/ProfileWizard/StepBasics.tsx,
    frontend/src/components/vendor/ProfileWizard/StepCategory.tsx,
    frontend/src/components/vendor/ProfileWizard/StepServices.tsx
  </files>
  <action>
Create the ProfileWizard directory and components:

**StepProgress.tsx** - Visual progress indicator:
```typescript
interface StepProgressProps {
  currentStep: number
  totalSteps: number
  steps: string[]
}

export function StepProgress({ currentStep, totalSteps, steps }: StepProgressProps) {
  return (
    <div className="mb-8">
      <div className="flex justify-between">
        {steps.map((step, idx) => (
          <div key={step} className="flex flex-col items-center flex-1">
            <div className={cn(
              "w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",
              idx + 1 < currentStep ? "bg-green-500 text-white" :
              idx + 1 === currentStep ? "bg-[#0F4C5C] text-white" :
              "bg-gray-200 text-gray-500"
            )}>
              {idx + 1 < currentStep ? <Check className="w-4 h-4" /> : idx + 1}
            </div>
            <span className={cn(
              "text-xs mt-1",
              idx + 1 <= currentStep ? "text-[#0F4C5C]" : "text-gray-400"
            )}>{step}</span>
          </div>
        ))}
      </div>
      <div className="mt-2 h-1 bg-gray-200 rounded">
        <div
          className="h-full bg-[#0F4C5C] rounded transition-all"
          style={{ width: `${((currentStep - 1) / (totalSteps - 1)) * 100}%` }}
        />
      </div>
    </div>
  )
}
```

**StepBasics.tsx** - Business name and description:
```typescript
import { useFormContext } from 'react-hook-form'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import { Button } from '@/components/ui/button'

interface StepBasicsProps {
  onNext: () => void
}

export function StepBasics({ onNext }: StepBasicsProps) {
  const { register, formState: { errors }, trigger } = useFormContext()

  const handleNext = async () => {
    const valid = await trigger(['business_name', 'description'])
    if (valid) onNext()
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-xl font-semibold mb-1">Tell us about your business</h2>
        <p className="text-gray-500">Start with the basics</p>
      </div>

      <div className="space-y-4">
        <div className="space-y-2">
          <Label htmlFor="business_name">Business Name *</Label>
          <Input
            id="business_name"
            {...register('business_name', { required: 'Business name is required' })}
            placeholder="Your business name"
          />
          {errors.business_name && (
            <p className="text-sm text-red-500">{errors.business_name.message as string}</p>
          )}
        </div>

        <div className="space-y-2">
          <Label htmlFor="description">Description *</Label>
          <Textarea
            id="description"
            {...register('description', { required: 'Description is required' })}
            placeholder="Describe your services and what makes you unique..."
            rows={4}
          />
          {errors.description && (
            <p className="text-sm text-red-500">{errors.description.message as string}</p>
          )}
        </div>
      </div>

      <div className="flex justify-end">
        <Button onClick={handleNext}>Next</Button>
      </div>
    </div>
  )
}
```

**StepCategory.tsx** - Category selection with descriptions:
```typescript
import { useFormContext, Controller } from 'react-hook-form'
import { VENDOR_CATEGORIES } from '@/lib/vendor-categories'
import { Button } from '@/components/ui/button'
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'
import { Label } from '@/components/ui/label'
import * as LucideIcons from 'lucide-react'

interface StepCategoryProps {
  onNext: () => void
  onBack: () => void
}

export function StepCategory({ onNext, onBack }: StepCategoryProps) {
  const { control, formState: { errors }, trigger } = useFormContext()

  const handleNext = async () => {
    const valid = await trigger('category')
    if (valid) onNext()
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-xl font-semibold mb-1">What service do you provide?</h2>
        <p className="text-gray-500">Select your primary category</p>
      </div>

      <Controller
        name="category"
        control={control}
        rules={{ required: 'Please select a category' }}
        render={({ field }) => (
          <RadioGroup value={field.value} onValueChange={field.onChange} className="grid gap-3">
            {VENDOR_CATEGORIES.map((cat) => {
              const Icon = LucideIcons[cat.icon as keyof typeof LucideIcons] as React.ComponentType<{ className?: string }>
              return (
                <Label
                  key={cat.value}
                  className={cn(
                    "flex items-start gap-4 p-4 border rounded-lg cursor-pointer hover:border-[#0F4C5C] transition-colors",
                    field.value === cat.value && "border-[#0F4C5C] bg-[#0F4C5C]/5"
                  )}
                >
                  <RadioGroupItem value={cat.value} className="mt-1" />
                  <div className="flex-1">
                    <div className="flex items-center gap-2">
                      {Icon && <Icon className="w-5 h-5 text-[#0F4C5C]" />}
                      <span className="font-medium">{cat.label}</span>
                    </div>
                    <p className="text-sm text-gray-500 mt-1">{cat.description}</p>
                  </div>
                </Label>
              )
            })}
          </RadioGroup>
        )}
      />
      {errors.category && (
        <p className="text-sm text-red-500">{errors.category.message as string}</p>
      )}

      <div className="flex justify-between">
        <Button variant="outline" onClick={onBack}>Back</Button>
        <Button onClick={handleNext}>Next</Button>
      </div>
    </div>
  )
}
```

**StepServices.tsx** - Service areas and pricing:
```typescript
import { useFormContext, Controller } from 'react-hook-form'
import { METRO_AREAS } from '@/lib/metro-areas'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Checkbox } from '@/components/ui/checkbox'

interface StepServicesProps {
  onSubmit: () => void
  onBack: () => void
  isSubmitting: boolean
}

export function StepServices({ onSubmit, onBack, isSubmitting }: StepServicesProps) {
  const { register, control, formState: { errors } } = useFormContext()

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-xl font-semibold mb-1">Service details</h2>
        <p className="text-gray-500">Where do you operate and what do you charge?</p>
      </div>

      <div className="space-y-4">
        <div className="space-y-2">
          <Label>Service Areas</Label>
          <p className="text-sm text-gray-500">Select the metros where you provide services</p>
          <Controller
            name="service_areas"
            control={control}
            defaultValue={[]}
            render={({ field }) => (
              <div className="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border rounded-lg p-3">
                {METRO_AREAS.map((metro) => (
                  <Label key={metro.value} className="flex items-center gap-2 cursor-pointer">
                    <Checkbox
                      checked={field.value?.includes(metro.value)}
                      onCheckedChange={(checked) => {
                        if (checked) {
                          field.onChange([...field.value, metro.value])
                        } else {
                          field.onChange(field.value.filter((v: string) => v !== metro.value))
                        }
                      }}
                    />
                    <span className="text-sm">{metro.label}</span>
                  </Label>
                ))}
              </div>
            )}
          />
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="price_min">Minimum Price ($)</Label>
            <Input
              id="price_min"
              type="number"
              {...register('price_min', { valueAsNumber: true })}
              placeholder="500"
            />
          </div>
          <div className="space-y-2">
            <Label htmlFor="price_max">Maximum Price ($)</Label>
            <Input
              id="price_max"
              type="number"
              {...register('price_max', { valueAsNumber: true })}
              placeholder="5000"
            />
          </div>
        </div>
      </div>

      <div className="flex justify-between">
        <Button variant="outline" onClick={onBack}>Back</Button>
        <Button onClick={onSubmit} disabled={isSubmitting}>
          {isSubmitting ? 'Creating Profile...' : 'Create Profile'}
        </Button>
      </div>
    </div>
  )
}
```

**index.tsx** - Main wizard container with auto-save:
```typescript
import { useState, useEffect } from 'react'
import { useForm, FormProvider } from 'react-hook-form'
import { useNavigate } from 'react-router-dom'
import { toast } from 'sonner'
import { useAuth } from '@/hooks/useAuth'
import { useCreateVendorProfile, useUpdateVendorProfile, useVendorProfile } from '@/hooks/useVendorProfile'
import { StepProgress } from './StepProgress'
import { StepBasics } from './StepBasics'
import { StepCategory } from './StepCategory'
import { StepServices } from './StepServices'
import { Card, CardContent } from '@/components/ui/card'

const STORAGE_KEY = 'vendor-profile-draft'
const STEPS = ['Basics', 'Category', 'Services', 'Complete']

interface ProfileFormData {
  business_name: string
  description: string
  category: string
  service_areas: string[]
  price_min: number | null
  price_max: number | null
}

export function ProfileWizard() {
  const navigate = useNavigate()
  const { user } = useAuth()
  const [step, setStep] = useState(1)
  const { data: existingProfile } = useVendorProfile(user?.id)
  const createProfile = useCreateVendorProfile()
  const updateProfile = useUpdateVendorProfile()

  // Load saved draft or existing profile
  const savedDraft = typeof window !== 'undefined'
    ? localStorage.getItem(STORAGE_KEY)
    : null
  const defaultValues: ProfileFormData = savedDraft
    ? JSON.parse(savedDraft)
    : existingProfile
    ? {
        business_name: existingProfile.business_name,
        description: existingProfile.description || '',
        category: existingProfile.category,
        service_areas: existingProfile.service_areas || [],
        price_min: existingProfile.price_min,
        price_max: existingProfile.price_max,
      }
    : {
        business_name: '',
        description: '',
        category: '',
        service_areas: [],
        price_min: null,
        price_max: null,
      }

  const methods = useForm<ProfileFormData>({
    defaultValues,
    mode: 'onChange',
  })

  // Auto-save on form change
  useEffect(() => {
    const subscription = methods.watch((data) => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
    })
    return () => subscription.unsubscribe()
  }, [methods])

  const handleSubmit = async () => {
    const data = methods.getValues()

    try {
      if (existingProfile) {
        await updateProfile.mutateAsync({
          id: user!.id,
          ...data,
          is_published: true,
        })
        toast.success('Profile updated!')
      } else {
        await createProfile.mutateAsync({
          id: user!.id,
          ...data,
          is_published: true,
        })
        toast.success('Profile created!')
      }
      localStorage.removeItem(STORAGE_KEY)
      navigate('/vendor/dashboard')
    } catch (error) {
      toast.error('Failed to save profile. Please try again.')
    }
  }

  const isSubmitting = createProfile.isPending || updateProfile.isPending

  return (
    <Card className="max-w-2xl mx-auto">
      <CardContent className="pt-6">
        <StepProgress currentStep={step} totalSteps={4} steps={STEPS} />

        <FormProvider {...methods}>
          {step === 1 && <StepBasics onNext={() => setStep(2)} />}
          {step === 2 && <StepCategory onNext={() => setStep(3)} onBack={() => setStep(1)} />}
          {step === 3 && (
            <StepServices
              onSubmit={handleSubmit}
              onBack={() => setStep(2)}
              isSubmitting={isSubmitting}
            />
          )}
        </FormProvider>
      </CardContent>
    </Card>
  )
}
```

Import cn from utils.ts, ensure all component imports use correct paths (@ alias or relative).
  </action>
  <verify>
- All 5 component files exist in frontend/src/components/vendor/ProfileWizard/
- ProfileWizard uses FormProvider from react-hook-form
- Auto-save to localStorage on form watch
- StepCategory imports VENDOR_CATEGORIES
- StepServices imports METRO_AREAS
  </verify>
  <done>
Multi-step wizard with 3 steps (Basics, Category, Services), auto-save, and progress indicator.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create wizard page and add route</name>
  <files>frontend/src/pages/vendor/ProfileWizardPage.tsx, frontend/src/App.js</files>
  <action>
Create **ProfileWizardPage.tsx**:
```typescript
import { Navigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'
import Navbar from '../../components/Navbar'
import { ProfileWizard } from '../../components/vendor/ProfileWizard'
import { Loader2 } from 'lucide-react'

export default function ProfileWizardPage() {
  const { user, isVendor, loading } = useAuth()

  if (loading) {
    return (
      <div className="min-h-screen bg-[#F9F8F4]">
        <Navbar />
        <div className="flex items-center justify-center py-20">
          <Loader2 className="w-8 h-8 animate-spin text-[#0F4C5C]" />
        </div>
      </div>
    )
  }

  // Must be logged in as vendor
  if (!user) {
    return <Navigate to="/login" replace />
  }

  if (!isVendor) {
    return <Navigate to="/dashboard" replace />
  }

  return (
    <div className="min-h-screen bg-[#F9F8F4]">
      <Navbar />
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-[#1A1A1A]" style={{ fontFamily: 'Playfair Display, serif' }}>
            Create Your Profile
          </h1>
          <p className="text-[#4A4A4A]">Let families discover your services</p>
        </div>

        <ProfileWizard />
      </div>
    </div>
  )
}
```

Update **App.js** to add the route:
1. Import ProfileWizardPage at top of file
2. Add route inside Routes component:
```jsx
<Route path="/vendor/profile/create" element={<ProfileWizardPage />} />
```

Place it near other vendor routes (near VendorDashboard route).
  </action>
  <verify>
- ProfileWizardPage.tsx exists with vendor role check
- App.js imports ProfileWizardPage
- Route /vendor/profile/create exists in App.js
- Page shows loading state, auth redirects, and ProfileWizard component
  </verify>
  <done>
Wizard page accessible at /vendor/profile/create for authenticated vendors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Ensure UI component dependencies</name>
  <files>frontend/src/components/ui/radio-group.jsx, frontend/src/components/ui/checkbox.jsx</files>
  <action>
Check if radio-group.jsx and checkbox.jsx exist. If they exist, no action needed.

If radio-group.jsx is missing, add it using shadcn CLI or create manually:
```bash
cd frontend && npx shadcn@latest add radio-group
```

If checkbox.jsx is missing (unlikely based on file list, but verify):
```bash
cd frontend && npx shadcn@latest add checkbox
```

The checkbox component was seen in the file list, so likely only radio-group needs verification.
  </action>
  <verify>
- frontend/src/components/ui/radio-group.jsx exists
- frontend/src/components/ui/checkbox.jsx exists
- Both components export properly (RadioGroup, RadioGroupItem, Checkbox)
  </verify>
  <done>
All required UI components available for wizard steps.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /vendor/profile/create as logged-in vendor
2. Complete Step 1 (Basics) and click Next
3. Refresh browser - form data should persist
4. Complete all steps and submit
5. Profile should be created in vendor_profiles table
</verification>

<success_criteria>
- Wizard navigates through all 3 steps
- localStorage saves form data on each change
- Form data persists after browser refresh
- Profile saves to database on completion
- User redirected to /vendor/dashboard after success
</success_criteria>

<output>
After completion, create `.planning/phases/02-vendor-supply-platform/02-04-SUMMARY.md`
</output>
