---
phase: 04-ai-enhancement
plan: 04
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - frontend/src/components/ai/RecommendationCard.tsx
  - frontend/src/components/ai/RecommendationsSection.tsx
  - frontend/src/pages/UserDashboard.jsx
  - frontend/src/pages/VendorDiscovery.jsx
autonomous: false

must_haves:
  truths:
    - "Dashboard shows AI recommendations section when user has an event"
    - "Recommendations grouped by category with top 3 vendors each"
    - "Each recommendation card shows AI explanation inline"
    - "User can dismiss a recommendation and see next option"
    - "User can refresh recommendations with updated preferences"
  artifacts:
    - path: "frontend/src/components/ai/RecommendationCard.tsx"
      provides: "Vendor card with AI explanation and dismiss button"
      exports: ["RecommendationCard"]
    - path: "frontend/src/components/ai/RecommendationsSection.tsx"
      provides: "Category-grouped recommendations with loading state"
      exports: ["RecommendationsSection"]
  key_links:
    - from: "frontend/src/components/ai/RecommendationsSection.tsx"
      to: "useRecommendations hook"
      via: "data fetching"
      pattern: "useRecommendations"
    - from: "frontend/src/pages/UserDashboard.jsx"
      to: "RecommendationsSection"
      via: "component render"
      pattern: "RecommendationsSection"
---

<objective>
Create recommendation UI components and integrate into user dashboard.

Purpose: Users see AI-powered vendor recommendations on their dashboard, grouped by category with explanations. Can dismiss vendors and refresh recommendations.
Output: RecommendationCard, RecommendationsSection components integrated into UserDashboard.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-ai-enhancement/04-CONTEXT.md
@.planning/phases/04-ai-enhancement/04-02-SUMMARY.md
@frontend/src/pages/UserDashboard.jsx
@frontend/src/components/VendorCard.jsx
@frontend/src/hooks/useRecommendations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RecommendationCard component</name>
  <files>frontend/src/components/ai/RecommendationCard.tsx</files>
  <action>
  Create **frontend/src/components/ai/RecommendationCard.tsx:**

  ```typescript
  import { X, MapPin, Star, Sparkles } from 'lucide-react'
  import { Button } from '../ui/button'
  import type { RecommendedVendor } from '../../hooks/useRecommendations'

  interface RecommendationCardProps {
    vendor: RecommendedVendor
    onDismiss: (vendorId: string) => void
    onViewProfile: (vendorId: string) => void
  }

  export function RecommendationCard({
    vendor,
    onDismiss,
    onViewProfile,
  }: RecommendationCardProps) {
    return (
      <div className="relative bg-white rounded-xl border border-[#E5E5E5] overflow-hidden hover:shadow-md transition-shadow group">
        {/* Dismiss button */}
        <button
          onClick={() => onDismiss(vendor.id)}
          className="absolute top-2 right-2 p-1.5 bg-white/80 hover:bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10"
          aria-label="Dismiss recommendation"
        >
          <X className="w-4 h-4 text-[#888888]" />
        </button>

        {/* Vendor image */}
        <div className="aspect-[4/3] bg-[#F9F8F4] overflow-hidden">
          {vendor.profile_photo_url ? (
            <img
              src={vendor.profile_photo_url}
              alt={vendor.business_name}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full flex items-center justify-center text-[#888888]">
              <span className="text-4xl font-light">
                {vendor.business_name.charAt(0)}
              </span>
            </div>
          )}
        </div>

        {/* Content */}
        <div className="p-4 space-y-3">
          {/* Header */}
          <div>
            <h4 className="font-semibold text-[#1A1A1A] line-clamp-1">
              {vendor.business_name}
            </h4>
            <div className="flex items-center gap-2 text-sm text-[#888888] mt-0.5">
              <MapPin className="w-3.5 h-3.5" />
              <span className="line-clamp-1">{vendor.location}</span>
              <span className="text-[#E5E5E5]">|</span>
              <span className="font-medium text-[#0F4C5C]">
                {vendor.price_range}
              </span>
            </div>
          </div>

          {/* AI Explanation */}
          <div className="flex gap-2 p-2.5 bg-[#FFF9E6] rounded-lg">
            <Sparkles className="w-4 h-4 text-[#C5A059] shrink-0 mt-0.5" />
            <p className="text-sm text-[#4A4A4A] leading-relaxed">
              {vendor.aiExplanation}
            </p>
          </div>

          {/* Action */}
          <Button
            onClick={() => onViewProfile(vendor.id)}
            variant="outline"
            className="w-full text-sm"
          >
            View Profile
          </Button>
        </div>
      </div>
    )
  }

  export default RecommendationCard
  ```

  Key features per CONTEXT.md:
  - Full vendor card: photo, name, location, price range
  - Explanation inline, always visible (gold background with sparkle icon)
  - Dismiss button (X) appears on hover
  - View Profile button to navigate to vendor detail
  </action>
  <verify>
  ```bash
  cat /Users/sreshtalluri/Documents/Github/arangetaram-planning/frontend/src/components/ai/RecommendationCard.tsx | grep -E "(export function|aiExplanation|onDismiss)"
  ```
  </verify>
  <done>RecommendationCard component with AI explanation, dismiss button, and view profile action</done>
</task>

<task type="auto">
  <name>Task 2: Create RecommendationsSection component</name>
  <files>frontend/src/components/ai/RecommendationsSection.tsx</files>
  <action>
  Create **frontend/src/components/ai/RecommendationsSection.tsx:**

  ```typescript
  import { useState, useMemo } from 'react'
  import { useNavigate } from 'react-router-dom'
  import { Sparkles, RefreshCw, Loader2, AlertCircle } from 'lucide-react'
  import { useRecommendations } from '../../hooks/useRecommendations'
  import { CATEGORIES } from '../../lib/categories'
  import { RecommendationCard } from './RecommendationCard'
  import { Button } from '../ui/button'
  import type { Event } from '../../hooks/useEvents'

  interface RecommendationsSectionProps {
    event: Event
  }

  export function RecommendationsSection({ event }: RecommendationsSectionProps) {
    const navigate = useNavigate()
    const [dismissedIds, setDismissedIds] = useState<Set<string>>(new Set())

    const {
      recommendations,
      isLoading,
      isError,
      error,
      refreshRecommendations,
      isFetching,
    } = useRecommendations({ eventId: event.id })

    // Filter out dismissed vendors
    const filteredRecommendations = useMemo(() => {
      const result: typeof recommendations = {}
      for (const [category, data] of Object.entries(recommendations)) {
        const filteredVendors = data.vendors.filter(
          (v) => !dismissedIds.has(v.id)
        )
        if (filteredVendors.length > 0) {
          result[category] = { vendors: filteredVendors }
        }
      }
      return result
    }, [recommendations, dismissedIds])

    const handleDismiss = (vendorId: string) => {
      setDismissedIds((prev) => new Set([...prev, vendorId]))
    }

    const handleViewProfile = (vendorId: string) => {
      navigate(`/vendors/${vendorId}`)
    }

    // Loading state with contextual message
    if (isLoading) {
      const eventMonth = new Date(event.event_date).toLocaleDateString('en-US', {
        month: 'long',
      })
      return (
        <div className="bg-white rounded-xl p-8 shadow-sm text-center">
          <Loader2 className="w-8 h-8 animate-spin text-[#0F4C5C] mx-auto mb-3" />
          <p className="text-[#4A4A4A]">
            Finding vendors for your {eventMonth} Arangetram...
          </p>
        </div>
      )
    }

    // Error state with retry
    if (isError) {
      return (
        <div className="bg-white rounded-xl p-8 shadow-sm text-center">
          <AlertCircle className="w-8 h-8 text-red-500 mx-auto mb-3" />
          <p className="text-[#4A4A4A] mb-4">
            {(error as Error)?.message || 'Failed to load recommendations'}
          </p>
          <Button onClick={refreshRecommendations} variant="outline">
            <RefreshCw className="w-4 h-4 mr-2" />
            Try Again
          </Button>
        </div>
      )
    }

    const categoryKeys = Object.keys(filteredRecommendations)

    // Empty state (no recommendations after filtering)
    if (categoryKeys.length === 0) {
      return (
        <div className="bg-white rounded-xl p-8 shadow-sm text-center">
          <Sparkles className="w-8 h-8 text-[#C5A059] mx-auto mb-3" />
          <p className="text-[#4A4A4A] mb-4">
            No more recommendations available. Try refreshing!
          </p>
          <Button onClick={refreshRecommendations} variant="outline">
            <RefreshCw className="w-4 h-4 mr-2" />
            Refresh Recommendations
          </Button>
        </div>
      )
    }

    return (
      <div className="space-y-6">
        {/* Header with refresh button */}
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Sparkles className="w-5 h-5 text-[#C5A059]" />
            <h2 className="text-xl font-semibold text-[#1A1A1A]">
              Recommended for You
            </h2>
          </div>
          <Button
            onClick={refreshRecommendations}
            variant="ghost"
            size="sm"
            disabled={isFetching}
            className="text-[#0F4C5C]"
          >
            <RefreshCw
              className={`w-4 h-4 mr-1.5 ${isFetching ? 'animate-spin' : ''}`}
            />
            Refresh
          </Button>
        </div>

        {/* Categories */}
        {categoryKeys.map((category) => {
          const categoryInfo = CATEGORIES.find((c) => c.id === category)
          const vendors = filteredRecommendations[category]?.vendors || []

          return (
            <div key={category}>
              <h3 className="text-lg font-medium text-[#1A1A1A] mb-3">
                {categoryInfo?.name || category}
              </h3>
              <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {vendors.slice(0, 3).map((vendor) => (
                  <RecommendationCard
                    key={vendor.id}
                    vendor={vendor}
                    onDismiss={handleDismiss}
                    onViewProfile={handleViewProfile}
                  />
                ))}
              </div>
            </div>
          )
        })}
      </div>
    )
  }

  export default RecommendationsSection
  ```

  Key features per CONTEXT.md:
  - Grouped by category needed
  - Top 3 vendors per category
  - Loading spinner with contextual message ("Finding vendors for your June Arangetram...")
  - Refresh button in header
  - Dismiss updates local state (session-based, not persisted)
  - Error state with "Try Again" button
  </action>
  <verify>
  ```bash
  cat /Users/sreshtalluri/Documents/Github/arangetaram-planning/frontend/src/components/ai/RecommendationsSection.tsx | grep -E "(export function|useRecommendations|refreshRecommendations|handleDismiss)"
  ```
  </verify>
  <done>RecommendationsSection with category grouping, loading states, refresh, and dismiss functionality</done>
</task>

<task type="auto">
  <name>Task 3: Integrate recommendations into UserDashboard</name>
  <files>frontend/src/pages/UserDashboard.jsx</files>
  <action>
  Update UserDashboard.jsx to show recommendations:

  1. Add import at top:
     ```jsx
     import { RecommendationsSection } from '../components/ai/RecommendationsSection'
     ```

  2. Find the main content grid (should be `<div className="grid lg:grid-cols-3 gap-8">`)

  3. In the left column (lg:col-span-2), after the "My Events" section, add:
     ```jsx
     {/* AI Recommendations Section */}
     {events.length > 0 && (
       <section className="mt-8">
         <RecommendationsSection event={events[0]} />
       </section>
     )}
     ```

  4. Alternatively, if no events exist, the empty state already prompts to create an event (per CONTEXT.md: "When no event exists, show 'Create an event to get personalized recommendations' prompt")

  The existing EmptyEventsState already encourages creating events, so no change needed there.
  </action>
  <verify>
  ```bash
  cat /Users/sreshtalluri/Documents/Github/arangetaram-planning/frontend/src/pages/UserDashboard.jsx | grep -E "(RecommendationsSection|import.*RecommendationsSection)"
  ```
  </verify>
  <done>UserDashboard shows RecommendationsSection when user has at least one event</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>AI recommendation UI on user dashboard with category grouping, explanations, dismiss, and refresh</what-built>
  <how-to-verify>
  1. Ensure frontend is running:
     ```bash
     cd /Users/sreshtalluri/Documents/Github/arangetaram-planning/frontend && yarn start
     ```

  2. Login to the app and navigate to User Dashboard

  3. If no events exist:
     - Verify "No events yet" prompt is shown
     - Create an event via the wizard

  4. With an event, verify recommendations:
     - "Recommended for You" section appears below My Events
     - Loading spinner shows with contextual message (e.g., "Finding vendors for your June Arangetram...")
     - Recommendations load grouped by category (e.g., Photographers, Caterers)
     - Each card shows vendor photo, name, location, price range
     - Each card has gold-highlighted AI explanation

  5. Test dismiss functionality:
     - Hover over a recommendation card
     - Click the X button
     - Card disappears, next vendor should show (if available)

  6. Test refresh:
     - Click "Refresh" button in header
     - Spinner animates
     - Recommendations reload

  7. Verify responsive layout:
     - On desktop: 3 cards per row
     - On mobile: 1-2 cards per row

  Expected: Full recommendation experience matching CONTEXT.md design decisions.
  </how-to-verify>
  <resume-signal>Type "approved" if recommendations work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] frontend/src/components/ai/RecommendationCard.tsx exports RecommendationCard
- [ ] frontend/src/components/ai/RecommendationsSection.tsx exports RecommendationsSection
- [ ] RecommendationCard shows AI explanation inline with gold background
- [ ] RecommendationCard has dismiss button (X) on hover
- [ ] RecommendationsSection groups by category
- [ ] RecommendationsSection has refresh button
- [ ] RecommendationsSection shows contextual loading message
- [ ] UserDashboard.jsx imports and renders RecommendationsSection
- [ ] Recommendations only shown when user has events
</verification>

<success_criteria>
Recommendation UI complete on dashboard:
- Categories from user's event shown with top 3 vendors each
- AI explanations visible on every card
- Dismiss button works (session-based)
- Refresh button reloads recommendations
- Loading/error states match CONTEXT.md design
</success_criteria>

<output>
After completion, create `.planning/phases/04-ai-enhancement/04-04-SUMMARY.md`
</output>
