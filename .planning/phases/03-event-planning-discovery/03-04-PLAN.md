---
phase: 03-event-planning-discovery
plan: 04
type: execute
wave: 3
depends_on: ["03-01", "03-03"]
files_modified:
  - frontend/src/components/vendor/PortfolioLightbox.tsx
  - frontend/src/components/discovery/AvailabilityBadge.tsx
  - frontend/src/components/discovery/SaveVendorButton.tsx
  - frontend/src/pages/VendorDetailPage.jsx
autonomous: true

must_haves:
  truths:
    - "User can click portfolio images to open fullscreen lightbox"
    - "User can navigate between images in lightbox with arrows"
    - "User can see availability badge showing if vendor is available on their event date"
    - "User can save/unsave vendor with heart button"
    - "Save state persists (button shows filled heart if already saved)"
  artifacts:
    - path: "frontend/src/components/vendor/PortfolioLightbox.tsx"
      provides: "Fullscreen image gallery modal"
      min_lines: 60
    - path: "frontend/src/components/discovery/AvailabilityBadge.tsx"
      provides: "Available/unavailable indicator"
      min_lines: 20
    - path: "frontend/src/components/discovery/SaveVendorButton.tsx"
      provides: "Heart button with save/unsave toggle"
      min_lines: 30
    - path: "frontend/src/pages/VendorDetailPage.jsx"
      provides: "Enhanced with lightbox, availability, save"
      min_lines: 200
  key_links:
    - from: "frontend/src/pages/VendorDetailPage.jsx"
      to: "frontend/src/components/vendor/PortfolioLightbox.tsx"
      via: "Dialog open state"
      pattern: "PortfolioLightbox"
    - from: "frontend/src/components/discovery/SaveVendorButton.tsx"
      to: "frontend/src/hooks/useSavedVendors.ts"
      via: "useSaveVendor/useUnsaveVendor"
      pattern: "useSaveVendor|useUnsaveVendor"
---

<objective>
Enhance VendorDetailPage with portfolio lightbox, availability badge, and save/favorite functionality.

Purpose: Enable rich vendor profile viewing with portfolio gallery and save for later
Output: Lightbox component, availability indicator, save button, integrated into detail page
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-event-planning-discovery/03-CONTEXT.md
@.planning/phases/03-event-planning-discovery/03-RESEARCH.md
@.planning/phases/03-event-planning-discovery/03-01-SUMMARY.md

# Page to enhance
@frontend/src/pages/VendorDetailPage.jsx
@frontend/src/hooks/useSavedVendors.ts
@frontend/src/hooks/useAvailability.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PortfolioLightbox component</name>
  <files>frontend/src/components/vendor/PortfolioLightbox.tsx</files>
  <action>
Create lightbox using Radix Dialog following RESEARCH.md Pattern 4:

```typescript
interface PortfolioLightboxProps {
  images: string[]
  initialIndex?: number
  open: boolean
  onOpenChange: (open: boolean) => void
}

export function PortfolioLightbox({ images, initialIndex = 0, open, onOpenChange }: PortfolioLightboxProps)
```

Features:
- Fullscreen overlay (bg-black/90)
- Close button (X) in top-right corner
- Left/right navigation arrows (ChevronLeft/ChevronRight icons)
- Image counter at bottom (e.g., "3 / 8")
- Keyboard navigation: Arrow keys for prev/next, Escape to close
- Image centered with max-h-[90vh] max-w-[90vw] object-contain
- Wrap-around navigation (last -> first, first -> last)

Use Radix Dialog for:
- Focus trap (keeps focus inside modal)
- Escape key handling
- Click-outside to close (on overlay)

Accessibility:
- aria-label on navigation buttons
- Dialog title (can be visually hidden)
  </action>
  <verify>TypeScript compiles: `cd frontend && npx tsc --noEmit`</verify>
  <done>PortfolioLightbox renders fullscreen gallery with navigation</done>
</task>

<task type="auto">
  <name>Task 2: Create AvailabilityBadge and SaveVendorButton</name>
  <files>
    frontend/src/components/discovery/AvailabilityBadge.tsx
    frontend/src/components/discovery/SaveVendorButton.tsx
  </files>
  <action>
**AvailabilityBadge.tsx:**
```typescript
interface AvailabilityBadgeProps {
  vendorId: string
  eventDate?: string  // yyyy-MM-dd format, from user's event
}
```

Logic:
1. If no eventDate provided, don't render anything
2. Fetch vendor's blocked dates using useBlockedDates(vendorId) hook
3. Check if eventDate is in blocked dates
4. Render:
   - Available: Green badge with CheckCircle icon "Available on [formatted date]"
   - Unavailable: Red badge with XCircle icon "Unavailable on [formatted date]"

Keep it lightweight - only shows when user has an event date to check against.

**SaveVendorButton.tsx:**
```typescript
interface SaveVendorButtonProps {
  vendorId: string
  variant?: 'icon' | 'button'  // icon = just heart, button = heart + text
  className?: string
}
```

Logic:
1. Get user from useAuth()
2. If not authenticated, show heart outline, onClick navigates to login with toast
3. Use useIsSaved(userId, vendorId) to check current state
4. Use useSaveVendor() and useUnsaveVendor() mutations
5. Toggle behavior: click saves if not saved, unsaves if saved

Visual:
- Unsaved: Heart outline (lucide-react Heart icon)
- Saved: Filled heart (use fill prop or different icon)
- Loading state during mutation
- Hover effect

variant='icon': Just the heart icon (for cards)
variant='button': Heart + "Save" / "Saved" text (for detail page)
  </action>
  <verify>TypeScript compiles</verify>
  <done>AvailabilityBadge shows availability status, SaveVendorButton toggles save state</done>
</task>

<task type="auto">
  <name>Task 3: Enhance VendorDetailPage with new components</name>
  <files>frontend/src/pages/VendorDetailPage.jsx</files>
  <action>
Integrate new components into existing VendorDetailPage:

**1. Portfolio Lightbox Integration:**
- Add state: `const [lightboxOpen, setLightboxOpen] = useState(false)`
- Add state: `const [lightboxIndex, setLightboxIndex] = useState(0)`
- Make gallery images clickable - onClick opens lightbox at that index
- Add PortfolioLightbox component at end of page

Update Gallery section:
```jsx
<div className="grid grid-cols-2 md:grid-cols-3 gap-4">
  {vendor.portfolio_images.map((img, idx) => (
    <button
      key={idx}
      onClick={() => { setLightboxIndex(idx); setLightboxOpen(true); }}
      className="relative h-32 w-full overflow-hidden rounded-lg hover:opacity-90 transition-opacity"
    >
      <img src={img} alt={...} className="h-full w-full object-cover" />
    </button>
  ))}
</div>
```

**2. Availability Badge:**
- Get user's event date from context or URL param
- For now, check if URL has ?eventDate=yyyy-MM-dd param
- Show AvailabilityBadge in the header area near title
- Later phases can auto-populate from user's active event

**3. Save Button:**
- Add SaveVendorButton in sidebar booking card
- Position: After "Request Booking" button, before contact info
- Use variant="button" for full button style
- Also add small heart icon version on the hero image (top-left corner)

**4. Update CTAs per CONTEXT.md:**
- "Request Booking" -> "Send Inquiry" (text change, functionality same for now)
- Save button equally prominent

Keep all existing functionality working.
  </action>
  <verify>
Visit /vendors/:id - portfolio images clickable, lightbox opens
Click arrows in lightbox - navigates between images
Save button visible and functional (requires login)
Availability badge shows when ?eventDate param present
  </verify>
  <done>
VendorDetailPage has lightbox, availability badge, and save functionality
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. Visit vendor detail page - see portfolio gallery
2. Click any portfolio image - lightbox opens at that image
3. Press arrow keys or click arrows - navigate through images
4. Press Escape or click X - lightbox closes
5. Visit /vendors/:id?eventDate=2026-03-15 - see availability badge
6. Click Save button when logged out - prompted to login
7. Click Save button when logged in - heart fills, vendor saved
8. Click again - heart unfills, vendor unsaved
9. Refresh page - save state persists
</verification>

<success_criteria>
- Portfolio lightbox opens on image click with navigation
- Keyboard navigation works (arrows, escape)
- Availability badge shows when eventDate URL param present
- Save button toggles saved state for authenticated users
- Save button prompts login for guests
- Save state persists across page refresh
</success_criteria>

<output>
After completion, create `.planning/phases/03-event-planning-discovery/03-04-SUMMARY.md`
</output>
